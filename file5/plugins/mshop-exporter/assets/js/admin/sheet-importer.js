jQuery(document).ready(function(a){"use strict";var b={sheets:[],current_index:0,btn_create_sheet:null,init:function(){b.btn_create_sheet=a("input.create-sheets"),a("input[name=sheet-csv]").customFile(),a(".upload-sheets").on("click",b.upload_sheets),b.btn_create_sheet.on("click",b.create_sheets)},is_blocked:function(a){return a.is(".processing")||a.parents(".processing").length},block:function(a){b.is_blocked(a)||a.addClass("processing disabled").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(a){a.removeClass("processing disabled").unblock()},add_message:function(c,d){a("p."+c,b.$message).length>0?(d=a("p."+c,b.$message).html()+d,a("p."+c,b.$message).html(d)):b.$message.append('<p class="'+c+'">'+d+"</p>")},make:function(){b.is_blocked()||(b.block(),b.$message.empty().css("display","block"),b.sheet_importer_init())},upload_sheets:function(){var c=a("#wpwrap");if(!b.is_blocked(c)){if(0===a("input[name=sheet-csv]")[0].files.length)return void alert("업로드할 파일을 선택해주세요.");b.block(c);var d=new FormData;d.append("file",a("input[name=sheet-csv]")[0].files[0]),d.append("action",msex_sheet_importer.action_upload_sheets),d.append("_wpnonce",msex_sheet_importer._wpnonce),a.ajax({url:ajaxurl,type:"POST",data:d,processData:!1,contentType:!1,success:function(b){b&&b.success?(a("div.pafw-upload-data").empty().append(b.data),a("input.create-sheets.button").removeAttr("disabled")):alert(b.data)},complete:function(){b.unblock(c)}})}},create_sheets:function(){if("disabled"!==b.btn_create_sheet.attr("disabled")){if(b.btn_create_sheet.attr("disabled","disabled"),b.sheets=a("tr.upload-sheet-items").not(".success"),0===b.sheets.length)return void alert("업로드할 송장 정보가 없습니다.");b.current_index=0,b.create_sheet()}},create_sheet:function(){for(var c=[],d=[],e=0;e<msex_sheet_importer.processing_count&&b.current_index<b.sheets.length;e++){var f=b.sheets[b.current_index++];a("td.status",f).html("..."),a(f).removeClass("fail").addClass("processing"),c.push(a(f).data("sheet_data")),d.push(f)}a.ajax({url:ajaxurl,type:"POST",data:{action:msex_sheet_importer.action_register_sheets,_wpnonce:msex_sheet_importer._wpnonce,sheet_data:c},success:function(c){a(d).removeClass("processing"),c&&c.success?(a("td.status",d).html("성공"),a(d).addClass("success"),b.current_index<b.sheets.length?b.create_sheet():b.btn_create_sheet.removeAttr("disabled")):(a("td.status",f).html("실패"),a(f).addClass("fail"),alert(c.data),b.btn_create_sheet.removeAttr("disabled"))},complete:function(){}})}};b.init()});