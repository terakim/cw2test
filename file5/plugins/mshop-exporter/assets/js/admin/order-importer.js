jQuery(document).ready(function(a){"use strict";var b={orders:[],current_index:0,btn_create_order:null,init:function(){b.btn_create_order=a("input.create-orders"),a("input[name=order-csv]").customFile(),a(".upload-orders").on("click",b.upload_orders),b.btn_create_order.on("click",b.create_orders)},is_blocked:function(a){return a.is(".processing")||a.parents(".processing").length},block:function(a){b.is_blocked(a)||a.addClass("processing disabled").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(a){a.removeClass("processing disabled").unblock()},add_message:function(c,d){a("p."+c,b.$message).length>0?(d=a("p."+c,b.$message).html()+d,a("p."+c,b.$message).html(d)):b.$message.append('<p class="'+c+'">'+d+"</p>")},make:function(){b.is_blocked()||(b.block(),b.$message.empty().css("display","block"),b.order_importer_init())},upload_orders:function(){var c=a("#wpwrap");if(!b.is_blocked(c)){if(0===a("input[name=order-csv]")[0].files.length)return void alert("업로드할 파일을 선택해주세요.");b.block(c);var d=new FormData;d.append("file",a("input[name=order-csv]")[0].files[0]),d.append("action",msex_order_importer.action_upload_orders),d.append("_wpnonce",msex_order_importer._wpnonce),a.ajax({url:ajaxurl,type:"POST",data:d,processData:!1,contentType:!1,success:function(b){b&&b.success?(a("div.pafw-upload-data").empty().append(b.data),a("input.create-orders.button").removeAttr("disabled")):alert(b.data)},complete:function(){b.unblock(c)}})}},create_orders:function(){if("disabled"!==b.btn_create_order.attr("disabled")){if(b.btn_create_order.attr("disabled","disabled"),b.orders=a("tr.upload-order-items").not(".success"),0===b.orders.length)return void alert("생성할 주문데이터가 없습니다.");b.current_index=0,b.create_order()}},create_order:function(){var c=b.orders[b.current_index];a("td.status",c).html("..."),a(c).removeClass("fail").addClass("processing"),a.ajax({url:ajaxurl,type:"POST",data:{action:msex_order_importer.action_create_orders,_wpnonce:msex_order_importer._wpnonce,order_data:a(c).data("order_data")},success:function(d){a(c).removeClass("processing"),d&&d.success?(a("td.status",c).html("성공"),a(c).addClass("success"),b.current_index++,b.current_index<b.orders.length?b.create_order():b.btn_create_order.removeAttr("disabled")):(a("td.status",c).html("실패"),a(c).addClass("fail"),alert(d.data),b.btn_create_order.removeAttr("disabled"))},complete:function(){}})}};b.init()});