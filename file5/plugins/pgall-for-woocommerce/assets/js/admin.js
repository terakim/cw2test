jQuery(document).ready(function(a){"use strict";var b=a("[id^=pafw-order].postbox"),c=function(){return b.is(".processing")||b.parents(".processing").length},d=function(){c(b)||b.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},e=function(){b.removeClass("processing").unblock()};({init:function(){a("#pafw-refund-request").on("click",this.refund_request),a("#pafw-repay-request").on("click",this.reqay_request),a("#pafw-check-receipt").on("click",this.check_receipt),a(".pafw-check-additional-charge-receipt").on("click",this.check_additional_charge_receipt),a("#pafw-escrow-register-delivery-info").on("click",{escrow_type:"I"},this.escrow_register_delivery_info),a("#pafw-escrow-modify-delivery-info").on("click",{escrow_type:"U"},this.escrow_register_delivery_info),a("#pafw-escrow-approve-reject").on("click",this.escrow_approve_reject),a("#pafw-vbank-refund-request").on("click",this.vbank_refund_request),a("#pafw-subscription-additional-charge").on("click",this.subscription_additional_charge),a("input.pafw-subscription-cancel-additional-charge").on("click",this.subscription_cancel_additional_charge),a("#pafw-cancel-batch-key").on("click",this.cancel_batch_key),a("#pafw-cash-amount").on("click",this.cash_amount),a("#pafw-cash-receipt").on("click",this.cash_receipt),a("#pafw-cancel-receipt").on("click",this.cancel_receipt),a("#pafw-view-receipt").on("click",this.view_receipt),a("#pafw-update-receipt-info").on("click",this.update_receipt_info),a("select[name=pafw_bacs_receipt_usage]").on("change",function(){a("div.receipt_usage").css("display","none"),a("div.receipt_usage.receipt_usage_"+a(this).val()).css("display","flex")}),a(".pafw_payment_info.bacs_receipt select, .pafw_payment_info.bacs_receipt input").on("change",function(){a("#pafw-cash-receipt").attr("disabled","disabled"),a("#pafw-update-receipt-info").removeAttr("disabled")})},refund_request:function(){if(!c()){var b={action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,order_id:_pafw_admin.order_id,_wpnonce:_pafw_admin._wpnonce,payment_action:"refund_request"};confirm("전체취소를 진행하시겠습니까?\n주문건의 전체항목이 취소가 됩니다.")&&(d(),a.post(ajaxurl,b,function(a){a?"true"==a.success||a.success?(alert(a.data),location.reload()):alert(a.data):alert("전체취소 요청 결과를 수신하지 못하였습니다.\n처리 결과 확인을 위해 영수증을 확인해 보시기 바랍니다."),e()}))}},reqay_request:function(){if(!c()){var b={action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,order_id:_pafw_admin.order_id,amount:a("#repay_price").val(),_wpnonce:_pafw_admin._wpnonce,payment_action:"repay_request"};confirm("부분취소처리를 진행하시겠습니까?\n\n1) 부분취소는 매입후 취소이기 때문에 당일 처리가 되지 않습니다.\n2) 부분취소 처리를 한 경우 전체 금액 취소가 불가능하며, 남은잔액을 모두 입력하여 취소 처리만 가능합니다.\n\n - 취소 요청 금액 : "+jQuery("#repay_price").val())&&(d(),a.post(ajaxurl,b,function(a){a?a.success?(alert(a.data),location.reload()):(alert(a.data),e()):(alert("부분취소 처리결과를 수신하지 못하였습니다.\n처리 결과 확인을 위해 영수증을 확인해 보시기 바랍니다."),e())}))}},check_receipt:function(){var a="",b="";_.isEmpty(_pafw_admin.receipt_popup_params)||_.isEmpty(_pafw_admin.receipt_popup_params.name)||(a=_pafw_admin.receipt_popup_params.name),_.isEmpty(_pafw_admin.receipt_popup_params)||_.isEmpty(_pafw_admin.receipt_popup_params.features)||(b=_pafw_admin.receipt_popup_params.features),window.open(_pafw_admin.receipt_url,a,b)},check_additional_charge_receipt:function(){var b="",c="";_.isEmpty(_pafw_admin.receipt_popup_params)||_.isEmpty(_pafw_admin.receipt_popup_params.name)||(b=_pafw_admin.receipt_popup_params.name),_.isEmpty(_pafw_admin.receipt_popup_params)||_.isEmpty(_pafw_admin.receipt_popup_params.features)||(c=_pafw_admin.receipt_popup_params.features),window.open(a(this).data("receipt_url"),b,c)},escrow_register_delivery_info:function(b){var c=a("#pafw-order-escrow #tracking_number").val();if(""===c)return void alert("송장번호를 입력해주세요.");confirm("배송 정보를 등록하시겠습니까?")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,order_id:_pafw_admin.order_id,tracking_number:c,_wpnonce:_pafw_admin._wpnonce,escrow_type:b.data.escrow_type,payment_action:"escrow_register_delivery_info"},success:function(a){a.success?(alert("배송정보 등록이 완료되었습니다.\n\n고객님께 물품 수령후에 에스크로 구매확인 및 거절 의사를 표시 요청을 하셔야 합니다."),window.location.reload()):(alert("관리자에게 문의하여주세요.\n\n에러 메시지 : \n"+a.data),e())}}))},escrow_approve_reject:function(){confirm("정말 환불 처리하시겠습니까?\n\n처리 이후에 이전 상태로 되돌릴 수 없습니다. 신중하게 선택해주세요.")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"escrow_approve_reject",order_id:_pafw_admin.order_id,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},vbank_refund_request:function(){var b=a("#vbank_refund_bank_code").val(),c=a("#vbank_refund_acc_num").val(),f=a("#vbank_refund_acc_name").val(),g=a("#vbank_refund_reason").val();""===b?alert("환불 은행을 선택해주세요."):""===c?alert("환불 계좌번호를 입력해주세요."):""===f?alert("환불 계좌주명을 입력해주세요."):confirm("정말 환불 처리하시겠습니까?\n\n처리 이후에 이전 상태로 되돌릴 수 없습니다. 신중하게 선택해주세요.")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"vbank_refund_request",order_id:_pafw_admin.order_id,refund_bank_code:b,refund_acc_num:c,refund_acc_name:f,refund_reason:g,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},subscription_additional_charge:function(){const b=0|parseInt(a("#subscription_additional_charge_amount").val()),c=a("#subscription_additional_charge_card_quota").val();b<=0?alert("추가 과금 요청 금액을 입력해주세요."):confirm("추가 과금을 요청하시겠습니까?")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"subscription_additional_charge",order_id:_pafw_admin.order_id,amount:b,card_quota:c,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},subscription_cancel_additional_charge:function(){var b=a(this).data("tid"),c=a(this).data("amount");confirm("추가 과금을 취소하시겠습니까?")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"subscription_cancel_additional_charge",order_id:_pafw_admin.order_id,tid:b,amount:c,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},cancel_batch_key:function(){var b=a(this).closest("div").find("#subscription_batch_key").val();if(_.isEmpty(b))return void alert("비활성화할 배치키를 입력해주세요.");confirm("[주의] 정기결제 배치키를 비활성화 하시겠습니까? 비활성화된 정기결제 배치키는 다시 활성화하실 수 없습니다.")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"subscription_cancel_batch_key",subscription_id:_pafw_admin.subscription_id,batch_key:b},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},cash_amount:function(){d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"cash_amount",order_id:_pafw_admin.order_id},success:function(b){b.success?(document.getElementById("npay_cash_amount")||a(document.body).append('<div id="npay_cash_amount" title="현금영수증 발행대상 금액"></div>'),a("#npay_cash_amount").empty().append(b.data).dialog({modal:!0,width:"400px",buttons:{Ok:function(){a(this).dialog("close")}}})):alert(b.data),e()}})},cash_receipt:function(){c()||confirm("현금영수증 발행을 요청하시겠습니까?")&&(d(),a.ajax({type:"POST",url:ajaxurl,data:{action:_pafw_admin.slug+"-pafw_cash_receipt",order_id:_pafw_admin.order_id,_wpnonce:_pafw_admin._wpnonce},success:function(a){a?"true"===a.success||a.success?(alert(a.data),location.reload()):(alert(a.data),e()):(alert("현금영수증 발행 요청중 오류가 발생했습니다. 잠시 후 다시 시도해주세요."),e())},error:function(a,b,c){alert(c),e()}}))},cancel_receipt:function(){c()||confirm("발행된 현금영수증을 취소하시겠습니까?")&&(d(),a.ajax({type:"POST",url:ajaxurl,data:{action:_pafw_admin.slug+"-pafw_cancel_receipt",order_id:_pafw_admin.order_id,_wpnonce:_pafw_admin._wpnonce},success:function(a){a?"true"===a.success||a.success?(alert(a.data),location.reload()):(alert(a.data),e()):(alert("현금영수증 취소 요청중 오류가 발생했습니다. 잠시 후 다시 시도해주세요."),e())},error:function(a,b,c){alert(c),e()}}))},view_receipt:function(){c()||(d(),a.ajax({type:"POST",url:ajaxurl,data:{action:_pafw_admin.slug+"-pafw_view_receipt",order_id:_pafw_admin.order_id,_wpnonce:_pafw_admin._wpnonce},success:function(a){if(a.success){var b=window.open("","","scrollbars=yes,width=480,height=700");null===b?alert("팝업이 차단되어 있습니다. 팝업설정을 변경하신 후 다시 시도해주세요."):(b.document.write(a.data),b.document.close())}else alert(a.data);e()},error:function(a,b,c){alert(c),e()}}))},update_receipt_info:function(){c()||confirm("현금영수증 발행정보를 업데이트 하시겠습니까?")&&(d(),a.ajax({type:"POST",url:ajaxurl,data:{action:_pafw_admin.slug+"-pafw_update_receipt_info",order_id:_pafw_admin.order_id,receipt_usage:a("select[name=pafw_bacs_receipt_usage]").val(),receipt_issue_type:a("select[name=pafw_bacs_receipt_issue_type]").val(),reg_number_ID:a("input[name=pafw_bacs_reg_number_ID]").val(),reg_number_POE:a("input[name=pafw_bacs_reg_number_POE]").val(),_wpnonce:_pafw_admin._wpnonce},success:function(a){a?"true"===a.success||a.success?(alert(a.data),location.reload()):(alert(a.data),e()):(alert("현금영수증 발행정보 업데이트중 오류가 발생했습니다. 잠시 후 다시 시도해주세요."),e())},error:function(a,b,c){alert(c),e()}}))}}).init()});