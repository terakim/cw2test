jQuery(function(a){"use strict";const b=function(a){void 0===a.data("pafwBACS")&&(this.$element=a,this._init(),a.data("pafwBACS",this))};b.prototype._init=function(){a("body").on("updated_checkout",this._bindEventHandler.bind(this))},b.prototype._bindEventHandler=function(){a("input[name=pafw_change_bacs_receipt_info]",this.$element).on("click",this._changeReceiptInfo.bind(this)),a("input[name=pafw_bacs_receipt_issue]",this.$element).on("click",this._refresh.bind(this)),a("input[name=pafw_bacs_receipt_usage]",this.$element).on("click",this._refresh.bind(this)),a("select[name=pafw_bacs_receipt_issue_type]",this.$element).on("change",this._refresh.bind(this)),this._refresh()},b.prototype._changeReceiptInfo=function(){a(".pafw_bacs_default_info",this.$element).css("display","none"),a("input[name=pafw_bacs_receipt_use_default]",this.$element).val("no"),this._refresh()},b.prototype._refresh=function(){if("yes"!==a("input[name=pafw_bacs_receipt_use_default]",this.$element).val()){a(".pafw_bacs_receipt").css("display","block");const b=a("input[name=pafw_bacs_receipt_issue]:checked",this.$element).val();a("div.receipt_issue").css("display","none"),a("div.receipt_issue.receipt_issue_"+b).css("display","block");const c=a("input[name=pafw_bacs_receipt_usage]:checked",this.$element).val();a("div.receipt_usage").css("display","none"),a("div.receipt_usage.receipt_usage_"+c).css("display","flex")}};var c=a(_pafw.checkout_form_selector),d={$forms:[],is_blocked:function(a){return a.is(".processing")||a.parents(".processing").length},block:function(a){d.is_blocked(a)||(a.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),d.$forms.push(a))},unblock:function(){_.each(d.$forms,function(a,b){a.removeClass("processing").unblock()}),d.$forms=[]}};a.fn.pafw_hook={hooks:[],add_filter:function(b,c){void 0===a.fn.pafw_hook.hooks[b]&&(a.fn.pafw_hook.hooks[b]=[]),a.fn.pafw_hook.hooks[b].push(c)},apply_filters:function(b,c){if(void 0!==a.fn.pafw_hook.hooks[b])for(var d=0;d<a.fn.pafw_hook.hooks[b].length;++d)c[0]=a.fn.pafw_hook.hooks[b][d](c);return c[0]}},a.fn.pafw=function(b){if("object"==typeof(b=b||{}))return this.each(function(){var c=a.extend({paymentMethods:_pafw.gateway,isOrderPay:_pafw.is_checkout_pay_page,isSimplePay:_pafw.simple_pay,ajaxUrl:_pafw.ajax_url,slug:_pafw.slug,gatewayDomain:_pafw.gateway_domain},b);new e(a(this),c)}),this;throw new Error("잘못된 호출입니다.: "+b)};var e=function(a,b){void 0===a.data("pafw")&&(this.$paymentForm=a,this.options=b||{},this.uuid=this._generateUUID(),this._registerHandler(),a.data("pafw",this))};e.prototype._ajaxUrl=function(){var a="";if("yes"===this.options.isSimplePay){var b=this.options.ajaxUrl.split("?");a=b.length>1?b[0]+"?action="+this.options.slug+"-pafw_simple_payment&"+b[1]:this.options.ajaxUrl+"?action="+this.options.slug+"-pafw_simple_payment"}else a=wc_checkout_params.checkout_url;return a},e.prototype._generateUUID=function(){var a=(new Date).getTime();return"pafw_"+"xxxxxxxxxxxxxxxxxxxx".replace(/[x]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:3&c|8).toString(16)})},e.prototype._paymentComplete=function(a){window.location.href=a},e.prototype._paymentCancel=function(){_pafw.is_mobile&&a("html").removeClass("pafw-payment"),a("#"+this.uuid).remove(),d.unblock()},e.prototype._paymentFail=function(b){setTimeout(function(){_pafw.is_mobile&&a("html").removeClass("pafw-payment"),a("#"+this.uuid).remove(),alert(b),d.unblock()}.bind(this))},e.prototype._registerHandler=function(){this.gateways=a.fn.pafw_hook.apply_filters("pafw_gateway_objects",[this.options.paymentMethods]);var c=_.flatten(_.values(this.options.paymentMethods)).map(function(a){return"checkout_place_order_"+a}).join(" ");this.options.isOrderPay?this.$paymentForm.on("submit",this.processOrderPay.bind(this)):this.$paymentForm.on(c,this.processPayment.bind(this)),a(".pafw_bacs_receipt_wrapper",this.$paymentForm).length>0&&new b(this.$paymentForm)},e.prototype._processPostMessage=function(b){b.origin===this.options.gatewayDomain&&("pafw_cancel_payment"===b.data.action||"pafw_payment_fail"===b.data.action?a.fn.payment_fail(b.data.message):"pafw_payment_complete"===b.data.action&&a.fn.payment_complete(b.data.redirect_url))},e.prototype._registerPaymentCallback=function(){a.fn.payment_complete=this._paymentComplete.bind(this),a.fn.payment_cancel=this._paymentCancel.bind(this),a.fn.payment_fail=this._paymentFail.bind(this),_.isUndefined(a.fn.pafwPostMessageHandler)||window.removeEventListener("message",a.fn.pafwPostMessageHandler,!0),a.fn.pafwPostMessageHandler=this._processPostMessage.bind(this),window.addEventListener("message",a.fn.pafwPostMessageHandler,!0)},e.prototype.openPaymentWindow=function(b,c){if(_.isUndefined(c.redirect_url)||_.isEmpty(c.redirect_url)){document.getElementById(b)||a(document.body).append('<div id="'+b+'" class="pafw-payment-form" style="width: 100%;height: 100%;position: fixed;top: 0;left:0;z-index: 99999;outline: none !important;"></div>'),_pafw.is_mobile&&a("html").addClass("pafw-payment");a("#"+b).empty().append(c.payment_form)}else window.location.href=c.redirect_url},e.prototype.processPayment=function(){var b=this.uuid,c=this;if(!1!==this.$paymentForm.triggerHandler("pafw_process_payment_"+a('input[name="payment_method"]:checked',this.$paymentForm).val())){if(d.is_blocked(this.$paymentForm))return!1;d.block(this.$paymentForm),this._registerPaymentCallback(),a.ajax({type:"POST",url:this._ajaxUrl(),data:this.$paymentForm.serialize(),success:function(e){var f="";try{if(e.indexOf("\x3c!--WC_START--\x3e")>=0&&(e=e.split("\x3c!--WC_START--\x3e")[1]),e.indexOf("\x3c!--WC_END--\x3e")>=0&&(e=e.split("\x3c!--WC_END--\x3e")[0]),f=a.parseJSON(e),"success"!==f.result)throw"Invalid response";c.openPaymentWindow(b,f)}catch(b){if(!0===f.reload||"true"===f.reload)return void window.location.reload();"true"===f.refresh&&a("body").trigger("update_checkout"),c.submitError(f.messages),d.unblock()}},dataType:"html"})}return!1},e.prototype.submitError=function(b){a(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),this.$paymentForm.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+b+"</div>"),this.$paymentForm.removeClass("processing").unblock(),this.$paymentForm.find(".input-text, select, input:checkbox").trigger("validate").blur(),this.scrollToNotices(),a(document.body).trigger("checkout_error",[b])},e.prototype.scrollToNotices=function(b){var c=a(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");c.length||(c=a(".form.checkout")),a.scroll_to_notices(c)},e.prototype.processOrderPay=function(){var b=this.uuid,c=this,e=a("input[name=payment_method]:checked",this.$paymentForm).val();return-1===_.flatten(_.values(this.options.paymentMethods)).indexOf(e)||!d.is_blocked(this.$paymentForm)&&(d.block(this.$paymentForm),this._registerPaymentCallback(),a.ajax({type:"POST",url:_pafw.ajax_url,data:{action:_pafw.slug+"-pafw_ajax_action",payment_method:e,payment_action:"process_order_pay",order_id:_pafw.order_id,order_key:_pafw.order_key,data:this.$paymentForm.serialize(),_wpnonce:_pafw._wpnonce},success:function(a){void 0!==a&&void 0!==a.success&&!0===a.success?c.openPaymentWindow(b,a.data):(alert(a.messages),d.unblock())}}),!1)},e.prototype.destroy=function(){},a("body").trigger("pafw_init_hook"),_.each(c,function(b,c){a(b).pafw()})});