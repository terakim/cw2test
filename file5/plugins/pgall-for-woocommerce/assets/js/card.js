jQuery(function(a){"use strict";var b=a("div.pafw-payment-methods"),c={$wrappers:[],init:function(){},is_blocked:function(a){return a.is(".processing")||a.parents(".processing").length},block:function(a){c.is_blocked(a)||(a.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.$wrappers.push(a))},unblock:function(){_.each(c.$wrappers,function(a,b){a.removeClass("processing").unblock()}),c.$wrappers=[]}};a.fn.pafw_block_controller=c,a.fn.pafw_hook={hooks:[],add_filter:function(b,c){void 0===a.fn.pafw_hook.hooks[b]&&(a.fn.pafw_hook.hooks[b]=[]),a.fn.pafw_hook.hooks[b].push(c)},apply_filters:function(b,c){if(void 0!==a.fn.pafw_hook.hooks[b])for(var d=0;d<a.fn.pafw_hook.hooks[b].length;++d)c[0]=a.fn.pafw_hook.hooks[b][d](c);return c[0]}},window.addEventListener("message",function(b){b.origin===_pafw.gateway_domain&&("pafw_cancel_payment"===b.data.action||"pafw_payment_fail"===b.data.action?(a("#pafw_payment_form").remove(),c.unblock()):"pafw_payment_complete"===b.data.action&&a.fn.payment_complete(b.data.redirect_url))});var d=function(){this.$form=null,this.init=function(b,d){this.$form=b,a.fn.payment_complete=this.payment_complete,a.fn.payment_fail=this.payment_fail,a("body").on("inicis_unblock_payment",c.unblock),this.$form.on(d,this.process_payment)},this.payment_complete=function(a){window.location.href=a},this.payment_cancel=function(){a("#pafw_payment_form").remove(),c.unblock()},this.payment_fail=function(b){alert(b),a("#pafw_payment_form").remove(),c.unblock()},this.process_payment=function(b,c){if(_.isUndefined(c.redirect_url)||_.isEmpty(c.redirect_url)){document.getElementById("pafw_payment_form")||a(document.body).append('<div id="pafw_payment_form" style="width: 100%;height: 100%;position: fixed;top: 0;z-index: 99999;"></div>');a("#pafw_payment_form").empty().append(c.payment_form)}else window.location.href=c.redirect_url}},e=function(){this.$form=null,this.init=function(c,d){this.$form=c,a.fn.payment_complete=this.payment_complete,a.fn.payment_fail=this.payment_fail,void 0===a.fn.pafw_kakaopay_return&&(a.fn.pafw_kakaopay_return=this.unblock.bind(this)),b.on(d,this.process_payment.bind(this))},this.payment_complete=function(a){window.location.href=a},this.payment_cancel=function(){a("#pafw_payment_form").remove(),c.unblock()},this.payment_fail=function(b){alert(b),a("#pafw_payment_form").remove(),c.unblock()},this.unblock=function(a){a&&alert(a),c.unblock()},this.process_payment=function(b,c){if(_.isUndefined(c.redirect_url)||_.isEmpty(c.redirect_url)){document.getElementById("pafw_payment_form")||a(document.body).append('<div id="pafw_payment_form" style="width: 100%;height: 100%;position: fixed;top: 0;z-index: 99999;"></div>');a("#pafw_payment_form").empty().append(c.payment_form)}else window.location.href=c.redirect_url}},f=function(){this.$form=null,this.init=function(c,d){this.$form=c,a.fn.payment_complete=this.payment_complete,a.fn.payment_fail=this.payment_fail,void 0===a.fn.pafw_kakaopay_return&&(a.fn.pafw_kakaopay_return=this.unblock.bind(this)),b.on(d,this.process_payment.bind(this))},this.payment_complete=function(a){window.location.href=a},this.payment_cancel=function(){a("#pafw_payment_form").remove(),c.unblock()},this.payment_fail=function(b){alert(b),a("#pafw_payment_form").remove(),c.unblock()},this.unblock=function(a){a&&alert(a),c.unblock()},this.process_payment=function(b,c){if(_.isUndefined(c.redirect_url)||_.isEmpty(c.redirect_url)){document.getElementById("pafw_payment_form")||a(document.body).append('<div id="pafw_payment_form" style="width: 100%;height: 100%;position: fixed;top: 0;z-index: 99999;"></div>');a("#pafw_payment_form").empty().append(c.payment_form)}else window.location.href=c.redirect_url}},g=function(){this.$form=null,this.$wrapper=a(".pafw-payment-method-item.nicepay"),this.$placeholder=a(".pafw-not-registered.custom-handler",this.$wrapper),this.$card_form=a(".pafw_card_form",this.$wrapper),this.$card_info=a(".pafw-registered",this.$wrapper),this.init=function(b,c){this.$form=b,a(".pafw-button.card-action.register",this.$wrapper).off("click").on("click",this.re_register_payment_method.bind(this)),this.$form.on(c,this.process_payment.bind(this)),this.$placeholder.on("click",this.show_register_form.bind(this))},this.show_register_form=function(){a(".pafw-payment-method-info",this.$wrapper).css("padding","5px"),this.$placeholder.css("display","none"),this.$card_info.css("display","none"),this.$card_form.css("display","block")},this.re_register_payment_method=function(){confirm("결제수단을 다시 등록하시겠습니까?")&&this.show_register_form()},this.process_payment=function(a,b){window.location.reload()}},h=function(){this.$form=null,this.$wrapper=a(".pafw-payment-method-item.settlepg"),this.$placeholder=a(".pafw-not-registered.custom-handler",this.$wrapper),this.$card_form=a(".pafw_card_form",this.$wrapper),this.$card_info=a(".pafw-registered",this.$wrapper),this.init=function(b,c){this.$form=b,a(".pafw-button.card-action.register",this.$wrapper).off("click").on("click",this.re_register_payment_method.bind(this)),this.$form.on(c,this.process_payment.bind(this)),this.$placeholder.on("click",this.show_register_form.bind(this))},this.show_register_form=function(){a(".pafw-payment-method-info",this.$wrapper).css("padding","5px"),this.$placeholder.css("display","none"),this.$card_info.css("display","none"),this.$card_form.css("display","block")},this.re_register_payment_method=function(){confirm("결제수단을 다시 등록하시겠습니까?")&&this.show_register_form()},this.process_payment=function(a,b){window.location.reload()}},i=function(){this.$form=null,this.oPay=null,this.init=function(a,b){this.$form=a,this.$form.on(b,this.process_payment.bind(this))},this.get_npay_object=function(a){return this.oPay=null,this.oPay=Naver.Pay.create({mode:_pafw_npay.mode,clientId:_pafw_npay.client_id,openType:_pafw_npay.open_type,payType:a.data.pay_type}),this.oPay},this.process_payment=function(b,c){if(_.isUndefined(c.redirect_url)||_.isEmpty(c.redirect_url)){document.getElementById("pafw_payment_form")||a(document.body).append('<div id="pafw_payment_form" style="width: 100%;height: 100%;position: fixed;top: 0;z-index: 99999;"></div>');a("#pafw_payment_form").empty().append(c.payment_form)}else window.location.href=c.redirect_url}},j=function(){this.$form=null,this.$wrapper=a(".pafw-payment-method-item.innopay"),this.$placeholder=a(".pafw-not-registered.custom-handler",this.$wrapper),this.$card_form=a(".pafw_card_form",this.$wrapper),this.$card_info=a(".pafw-registered",this.$wrapper),this.init=function(b,c){this.$form=b,a(".pafw-button.card-action.register",this.$wrapper).off("click").on("click",this.re_register_payment_method.bind(this)),this.$form.on(c,this.process_payment.bind(this)),this.$placeholder.on("click",this.show_register_form.bind(this))},this.show_register_form=function(){a(".pafw-payment-method-info",this.$wrapper).css("padding","5px"),this.$placeholder.css("display","none"),this.$card_info.css("display","none"),this.$card_form.css("display","block")},this.re_register_payment_method=function(){confirm("결제수단을 다시 등록하시겠습니까?")&&this.show_register_form()},this.process_payment=function(a,b){window.location.reload()}},k=function(){this.$form=null,this.$wrapper=a(".pafw-payment-method-item.lguplus"),this.$placeholder=a(".pafw-not-registered.custom-handler",this.$wrapper),this.$card_form=a(".pafw_card_form",this.$wrapper),this.$card_info=a(".pafw-registered",this.$wrapper),this.init=function(b,c){this.$form=b,a(".pafw-button.card-action.register",this.$wrapper).off("click").on("click",this.re_register_payment_method.bind(this)),this.$form.on(c,this.process_payment.bind(this)),this.$placeholder.on("click",this.show_register_form.bind(this))},this.show_register_form=function(){a(".pafw-payment-method-info",this.$wrapper).css("padding","5px"),this.$placeholder.css("display","none"),this.$card_info.css("display","none"),this.$card_form.css("display","block")},this.re_register_payment_method=function(){confirm("결제수단을 다시 등록하시겠습니까?")&&this.show_register_form()},this.process_payment=function(a,b){window.location.reload()}},l=function(){this.$form=null,this.$wrapper=a(".pafw-payment-method-item.tosspayments"),this.$placeholder=a(".pafw-not-registered.custom-handler",this.$wrapper),this.$card_form=a(".pafw_card_form",this.$wrapper),this.$card_info=a(".pafw-registered",this.$wrapper),this.init=function(b,c){this.$form=b,a(".pafw-button.card-action.register",this.$wrapper).off("click").on("click",this.re_register_payment_method.bind(this)),this.$form.on(c,this.process_payment.bind(this)),this.$placeholder.on("click",this.show_register_form.bind(this))},this.show_register_form=function(){a(".pafw-payment-method-info",this.$wrapper).css("padding","5px"),this.$placeholder.css("display","none"),this.$card_info.css("display","none"),this.$card_form.css("display","block")},this.re_register_payment_method=function(){confirm("결제수단을 다시 등록하시겠습니까?")&&this.show_register_form()},this.process_payment=function(a,b){window.location.reload()}},m=function(){this.$payment_methods_wrapper=null,this.gateways=null,this.init=function(b){this.$payment_methods_wrapper=b;var c={inicis:new d,kakaopay:new e,nicepay:new g,npay:new i,settlebank:new f,settlepg:new h,innopay:new j,lguplus:new k,tosspayments:new l};this.gateway_object=a.fn.pafw_hook.apply_filters("pafw_gateway_objects",[c]);_pafw.supported_payment_methods.map(function(a){return"register_payment_methods_"+a}).join(" ");a(".pafw-not-registered:not(.custom-handler), .pafw-register-custom-handler").on("click",this.register_payment_method.bind(this)),a(".pafw-button.card-action.register").on("click",this.re_register_payment_method.bind(this)),a(".pafw-button.card-action.delete").on("click",this.delete_payment_method.bind(this)),_.each(_pafw.gateway,function(a,b){if(void 0!==this.gateway_object[b]){var c=_.values(a).map(function(a){return"register_payment_methods_"+a}).join(" ");this.gateway_object[b].init(this.$payment_methods_wrapper,c)}}.bind(this))},this.re_register_payment_method=function(a){confirm("결제수단을 다시 등록하시겠습니까?")&&this.register_payment_method(a)},this.register_payment_method=function(b){var d=this;if(c.is_blocked(d.$payment_methods_wrapper))return!1;c.block(d.$payment_methods_wrapper);var e=a(b.target).data("payment_method");a.ajax({type:"POST",url:pafw_ajaxurl,data:{action:_pafw.slug+"-pafw_ajax_action",payment_method:e,payment_action:"register_payment_method",params:a(b.target).closest("form").serialize()},success:function(a){a&&a.success?d.$payment_methods_wrapper.trigger("register_payment_methods_"+e,a.data):(alert(a.data),c.unblock())}})},this.delete_payment_method=function(b){var d=this;if(confirm("등록하신 결제수단을 삭제하시겠습니까?")){if(c.is_blocked(d.$payment_methods_wrapper))return!1;c.block(d.$payment_methods_wrapper);var e=a(b.target).data("payment_method");a.ajax({type:"POST",url:pafw_ajaxurl,data:{action:_pafw.slug+"-pafw_ajax_action",payment_method:e,payment_action:"delete_payment_method"},success:function(a){a&&a.success?window.location.reload():(alert(a.data),c.unblock())}})}}};a("body").trigger("pafw_init_hook"),(new m).init(b)});